<div class="archive-list">
  <ul class="archive">
      <% var postArray = eval('site.posts.data'); %>
<% if (is_home()) { %>
  <% postArray = postArray.filter(post => post.hide !== true); %>
<% } %>


      <!--ÊñáÁ´†ÂÖàÊåâÁÖßÊó∂Èó¥ÊéíÂ•ΩÂ∫è-->
      <% postArray.sort((a, b) => {
          if (a.date > b.date) {
            return -1;
          }
          if (a.date < b.date) {
            return 1;
          }
          return 0;
        }) 
      %>


      
      <% class HashMap {
        constructor() {
          this.map = {};
        }
      
        put(key, value) {
          this.map[key] = value;
        }
      
        get(key) {
          return this.map[key];
        }
      
        containsKey(key) {
          return key in this.map;
        }
      
        remove(key) {
          delete this.map[key];
        }
      
        size() {
          return Object.keys(this.map).length;
        }
      
        isEmpty() {
          return this.size() === 0;
        }
      
        clear() {
          this.map = {};
        }
      }
      %>

      <% class List {
        constructor() {
          this.items = [];
        }
      
        add(item) {
          this.items.push(item);
        }
      
        remove(item) {
          const index = this.items.indexOf(item);
          if (index > -1) {
            this.items.splice(index, 1);
          }
        }
      
        get(index) {
          return this.items[index];
        }
      
        size() {
          return this.items.length;
        }
      }
       %>

      <% const hashmap = new HashMap() %>
      <% const allYearList = new List() %>
      <% var topPostArray = [] %>

      <!--Âæ™ÁéØÈÅçÂéÜÊñáÁ´†Êï∞ÁªÑ-->
      <% for (let i = 0; i < postArray.length; i++) { 
  if(!is_home() || !('hide' in postArray[i]) || postArray[i].hide == false) {
          if('top' in postArray[i]) {
            topPostArray.push(postArray[i]);
          } else {
            var postYear = new Date(postArray[i].date).getFullYear();
            if(!hashmap.containsKey(postYear)) {
              hashmap.put(postYear, new List());
              allYearList.add(postYear);
            } 
            hashmap.get(postYear).add(postArray[i]);
          }
        }
      }  %>

      <!--ÊéíÂ∫è ÁΩÆÈ°∂ ÊñáÁ´†-->
      <% 
        topPostArray.sort((a, b) => {
          return a.top - b.top;
        }) 
      %>

      <!--ÂÖàÊîæ ÁΩÆÈ°∂ ÊñáÁ´†-->
      <% for (let i = 0; i < topPostArray.length; i++) { %>
          <% var thisPost = topPostArray[i] %>
          <li>
            <span class="archive-date"> &nbsp;&nbsp;&nbsp;TOP
            </span>
            <div class="archive-main">
                <a class="archive-title" href="<%- url_for(thisPost.path) %>"><%= thisPost.title %></a>
            </div>
          </li>
      <% } %>

      <!--rough-notationÈ£éÊ†ºÊïàÊûú-->
      <% if(theme && theme.listInfo.enable) { %>
        <script src="<%= url_for('/js/roughNotation.js') %>" defer></script>
        <script>
          // ÊµèËßàÂô®‰∏•Ê†ºÊ®°Âºè
          if (typeof window !== 'undefined') {
            window.themeConfig = <%- JSON.stringify(theme) %>;
          }
          document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.archive-title').forEach(el => {
              const annotation = RoughNotation.annotate(el, {
                type: themeConfig?.tool?.hoverStyle || 'underline', // ÊïàÊûú,ÈªòËÆ§‰∏∫'underline'
                color: themeConfig?.tool?.hoverColor || '#4f7dde', // Ëá™ÂÆö‰πâÊïàÊûúÈ¢úËâ≤
                animationDuration: themeConfig?.tool?.animationDuration || 800, // Âä®ÁîªÊåÅÁª≠Êó∂Èó¥ms
              });
              el.addEventListener('mouseenter', () => {
                if(annotation){
                annotation.show();
            }});
              el.addEventListener('mouseleave', () => {
                if(annotation){
                annotation.hide();
            }});
            });
          });
        </script>
        <% } %>

      <!--ÊñáÁ´†ÂÖàÊåâÁÖßÊó∂Èó¥ÊéíÂ•ΩÂ∫è-->
      <% postArray.sort((a, b) => {
        if (a.updated > b.updated) {
          return -1;
        }
        if (a.updated < b.updated) {
          return 1;
        }
        return 0;
      }) 
    %>
      
      <!--ÂÜçÊîæ ÊúÄËøëÊõ¥Êñ∞ ÊñáÁ´†-->
      <% if(theme.tool.recentUpdatePost) { %>
        <li>
          <span class="year-font-color">
            <a class="archive-title"  href="/recent-updates/">Recent-Updates</a>
          </span>
        </li>
        <% var countRecentPost = 0 %>
        <% for (let i = 0; i < postArray.length && countRecentPost < 3; i++) { %>
  <% if(is_home() && ('hide' in postArray[i]) && postArray[i].hide == true) { continue; } else { countRecentPost++;}%>
          <% var thisPost = postArray[i] %>
          <li>
            <span class="archive-date"><%= date(thisPost.updated, "YYYY/MM/DD") %> 
            </span>
            <div class="archive-main">
                <a class="archive-title" href="<%- url_for(thisPost.path) %>"><%= thisPost.title %></a>
            </div>
          </li>
        <% } %>
      <% } %>

      <!--ÂêéÊîæ ÂÖ∂‰ªñ ÊñáÁ´†-->
      <% for (let i = 0; i < allYearList.size(); i++) { %>
        <% var year = allYearList.get(i) %>
        <li>
          <span class="year-font-color"><%= year %>[<%= hashmap.get(year).size() %>]
            <% if(i==0) { %> <span class="darkmode-ignore">üçÉ</span> <% } %>
          </span>
        </li>
        <% var thisYearPostList = hashmap.get(year) %>
        <% for(var j = 0; j < thisYearPostList.size(); j++) { %>
  <% var thisPost = thisYearPostList.get(j) %>
  <li>
    <span class="archive-date">&nbsp;&nbsp;&nbsp;<%= date(thisPost.date, "MM/DD") %> 
    </span>
    <div class="archive-main">
      <% if(thisPost.categories && thisPost.categories.length > 0) { %>
  <% thisPost.categories.forEach(function(category, index) { %>
    <a class="archive-title" href="<%= url_for(category.path) %>">
      <%= category.name %>
    </a><%= index < thisPost.categories.length - 1 ? ' | ' : '' %>
  <% }); %>
<% } %>

      <% if (!is_home() || !thisPost.hide) { %>
        <!-- ‰ªÖÂΩì‰∏çÊòØ‰∏ªÈ°µÔºåÊàñËÄÖ‰∏ªÈ°µ‰ΩÜÊ≤°Êúâ hide ÊâçÊòæÁ§∫Ê†áÈ¢ò -->
        <a class="archive-title" href="<%- url_for(thisPost.path) %>">
          <%= thisPost.title %>
        </a>
      <% } %>

      <% if(thisPost.tags && thisPost.tags.length > 0) { %>
        <% for (let k = 0; k < thisPost.tags.length; k++) { %>
          <a class="archive-title" href="<%= url_for(thisPost.tags[k].path) %>">
            #<%= thisPost.tags[k].name %>
          </a>
        <% } %>
      <% } %>
    </div>
  </li>
<% } %>
      <% } %>
  </ul>
</div>
<!-- <%- partial('_partial/paginator') %> -->